box: 
   id: jpusk/playscala
   tag: 0.1
   ports:
     - '9000'

build:
   steps:
    - script:
         code: |
            yum install -y git
            git clone https://github.com/orashio/ScalaPlayTest.git
            cd ScalaPlayTest && sbt compile

push-to-dockerhub:
   steps:
    - internal/docker-push:
        username: $USERNAME
        password: $PASSWORD
        repository: orashio/wercker-test
        ports: "9000"
        working-dir: /pipeline/source/ScalaPlayTest
        cmd: sbt run

deploy-to-k8s:
   box:
      id: orashio/wercker-test
      ports: 
        - '9000'
   steps:
      - kubectl:
           name: create namespace    
           server: $KUBERNETES_MASTER
           token: $KUBERNETES_TOKEN
           insecure-skip-tls-verify: true
           command: apply -f $WERCKER_ROOT/ScalaPlayTest/kubernetes-namespace.yml
      - script:
           name: wait to create namespace
           code: sleep 10
      - kubectl:
           name: create deployment
           server: $KUBERNETES_MASTER
           token: $KUBERNETES_TOKEN
           insecure-skip-tls-verify: true
           command: apply -f $WERCKER_ROOT/ScalaPlayTest/kubernetes-deployment.yml --namespace=$WERCKER_APPLICATION_OWNER_NAME
